2022.11.02 20:42
Tags: #z 

# Facrorio brain base

В факторио можно, используя интерфейсный мод `Helmod`, рассчитать схему: сколько ресурсов нужно поставлять, сколько будет производиться, и сколько для всего этого нужно машин.
Однако, в игре существует несколько тиров `машин`, а так же `маяки`, положительный эффект которых точно `рассчитать очень трудно`, а еще `модули` трех уровней.
Все это в `совокупности` не позволяет выполнить единоразво `рассчет для схемы` - при каждом обновлении одногог из компонентов нужно делать почти полный `перерассчет`.

`Цель` этого проекта - сделать `глобальную` логическую систему, которая будет `автоматически` рассчиывать настоящее потребление блока, а так же производимый им ресурс.
Имея эти данные у всех блоков на фабрике, можно понимать, какого ресурса `не хватает`, и нужно наращивать его производство, а какой еще `имеется` в запасе.

Соеденив эту систему с налаженной стстемой поездов, можно добиться полуавтоматического распределения ресурсов по станциям.


Логическая сеть должна `самостоятельно` рассчитывать выработку/потребление продукта у каждого блока при его `полной` производительности (когда в нем все механизмы активны).

Для рассчета выработки используем мод `Inventory Sensor` - позволяет подключаться логический сети к механизмам и считывать их содержимое и % производства.

Если у всех механизмав в блоке этот % !== 0, значит все они находятся `в работе` => следовательно блок полностью функционирует.
Из этого следует, что количество производимого продукта в таком режиме - и есть то количество, которое может производить блок при максимальной `производительности`. Для подсчета этого значения можно воспользоваться подсчетом `среднего значения` предметов на выходящих конвеерных лентах. В этом поможет `чертеж` собственнной разработки.

Что бы рассчитать `потребляемый` ресурс, в блок будет поставляться слегка `завышенное` их количество, но не пропускаться по конвеерным лентам. 
Как это?
Предположим. на входе в цех есть 6 линий. 5 из них `заблокированы`. Если на 6ом конвеере обнаруженая `полная` проходимость ресурсов (это означает, что все они полностью потребляются цехом) - 5ый разблокируется. Если и он будет пропускать все внутрь (то есть уже с 2ух конвееров все потребляется) - `разблокируется` 4ый, и так далее.
Среднее пропускное значение так же можно `подсчитывать` при помощи логики.

Итого:
Имеется `производство` (например) 120 жлезный плит
А на другом блоке 36 `потребляются`

Оба значения можно отправлять в глобальную сисетму и `вычитать` из друг-друга. В результате получим, что у нас `есть` еще 84 железных плит в секунуду, которые можно распределить по фабрике.

Если текущее значение начинает быть меньше максимального - включаем `оповещение` 
Сравнивать нужно `процентно`. 
Если текущее меньше максимального значение на:
- 10% - все ок
- 20% - желтое оповещение
- 40% - красное оповещение


## Проблемы

1. Невозможно `подсчитать`, когда все машины в блоке `работают`.
В Ванильной версии логику нельзя подключить `напрямую` к, например, сборочным автоматам. Конечно, можно `придумать` логическую сисему, которая будет определять это по проходимости ресурсов по конвеерам на выходе, но такая сисема слишком `громозская`, и тяжелая для производительности фабрики.

Решение
Воспользоваться модом `Inventory Sensor`

2. Заполнение выхода ресурсами.
При подсчете среднего значения производимого блоком ресурса мы пользуемся подсчетом его среднего количества на конвеерах. Но скорее всего он будет потребляться не весь, и излишки рано или поздно заполнять буферные сундуки -> конвееры заплнятся, а подсчет станет невозможен.

Решение
Добавить условия для среднего посчета, при котором подсчет останавливается, если сундуки заполнены.

### Мысли

0 - отключить подсчет среднего количества, сбросить максимальное значение
1 - использовать максимальное значение
2 - использовать среднее значение
4 - преопределить максимальноре значение

- цех работает И буфер не полный
- да - подсчет
- нет - 
	- 


### Zero-Links
- 

### Links
- 